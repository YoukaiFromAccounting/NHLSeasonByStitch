<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Existing head content -->
</head>
<body>
  <!-- Existing body content -->

  <script>
    // Continuation of populateColourSelectors
    o.selected = c['Hex Code'] === def
    sel.appendChild(o)
  })
  sel.value = def
  colors[id.replace('ColorSelect', '').toLowerCase()] = def
})

// show color controls after populating
if (choices.length > 0) {
  document.getElementById('colourControls').style.display = 'flex'
}
}

function generateScarf() {
  const season = document.getElementById('seasonSelect').value
  const team = document.getElementById('teamSelect').value
  const width = parseInt(document.getElementById('scarfWidth').value)
  if (!season || !team) return alert('Please select season and team')

  const scarf = document.getElementById('scarf')
  scarf.innerHTML = ''
  scarf.style.width = `${width}px`

  const games = gameData.filter(g => g.season === season && (g.home_team_code === team || g.away_team_code === team))

  games.forEach(g => {
    const div = document.createElement('div')
    div.className = 'scarf-stripe'

    const result = g.result // win, loss, ot_win, ot_loss, preseason
    let baseColor = '#ccc'
    if (result === 'win') baseColor = colors.win
    else if (result === 'loss') baseColor = colors.loss
    else if (result === 'ot_win') baseColor = colors.otWin
    else if (result === 'ot_loss') baseColor = colors.otLoss
    else if (result === 'preseason') baseColor = colors.preseason

    div.style.backgroundColor = baseColor

    // Emojis for first goal and comeback
    let emoji = ''
    if (g.first_goal === team) emoji += 'âš¡'
    if (g.comeback === 'TRUE') emoji += 'ðŸ”¥'

    if (emoji) {
      const e = document.createElement('div')
      e.className = 'scarf-emoji'
      e.textContent = emoji
      div.appendChild(e)
    }

    // Tooltip
    div.addEventListener('mouseover', e => {
      const tooltip = document.getElementById('tooltip')
      tooltip.style.display = 'block'
      tooltip.style.left = e.pageX + 'px'
      tooltip.style.top = (e.pageY + 15) + 'px'
      tooltip.innerHTML = `
        <strong>${g.date}</strong><br>
        ${g.away_team_code} @ ${g.home_team_code}<br>
        Score: ${g.away_score} - ${g.home_score}<br>
        Shots: ${g.away_shots} - ${g.home_shots}<br>
        Arena: ${g.venue}<br>
        ${g.notes || ''}`
    })

    div.addEventListener('mouseleave', () => {
      document.getElementById('tooltip').style.display = 'none'
    })

    scarf.appendChild(div)
  })

  updateStats(games, team)
}

function updateStats(games, team) {
  const stats = {
    wins: 0,
    losses: 0,
    otWins: 0,
    otLosses: 0,
    preseason: 0,
    comebacks: 0,
    firstGoals: 0
  }
  games.forEach(g => {
    if (g.result === 'win') stats.wins++
    else if (g.result === 'loss') stats.losses++
    else if (g.result === 'ot_win') stats.otWins++
    else if (g.result === 'ot_loss') stats.otLosses++
    else if (g.result === 'preseason') stats.preseason++

    if (g.first_goal === team) stats.firstGoals++
    if (g.comeback === 'TRUE') stats.comebacks++
  })

  const statBox = document.getElementById('stats')
  statBox.innerHTML = ''
  Object.entries(stats).forEach(([key, val]) => {
    const card = document.createElement('div')
    card.className = 'stat-card'

    const valDiv = document.createElement('div')
    valDiv.className = 'stat-value'
    valDiv.textContent = val

    const label = document.createElement('div')
    label.className = 'stat-label'
    label.textContent = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())

    card.appendChild(valDiv)
    card.appendChild(label)
    statBox.appendChild(card)
  })
}
  </script>
</body>
</html>
